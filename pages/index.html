<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>mockup with bootstrap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/jqueryFileTree.css" rel="stylesheet">
  <link href="../css/merged.css" rel="stylesheet">
  <link href="../css/bootstrap-select.css" rel="stylesheet">
  <style type="text/css">
  body {
    padding-top: 60px;
  }

  #fileNav {
    height: 100%;
    min-height: 100%;
  }

  html, body {
    height: 90%;
  }

  .fill { 
    min-height: 100%;
    height: 100%;
  }

  #centerContent .span12 {
    background-color:#eee; 
    border: 1px solid #888; 
    border-radius:3px;
    padding: 15px;
  }

  #overviewTable td { border: 3px white solid; }
  #overviewTable th { 
    font-family: Verdana,Arial,Helvetica,sans-serif;
    font-weight: normal;
    font-size: .9em;
    font-color: black;
    text-align: left;
    color: black;
    margin: 0;
    padding: 5px 12px 5px 12px;
    vertical-align: top;
    border: 3px solid #FFF;
    background-color: ##f5f5f5;
  }
  #overviewTable img {
    min-width: 85px;
    min-height: 85px;
  }
  </style>
</head>

<body>
  <div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container-fluid">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
        <a class="brand" href="#">gofcm</a>
        <div class="nav-collapse collapse">
          <ul class="nav">
            <li><a href="#about">Project</a></li>
            <li><a href="#about">File</a></li>
            <li class="active"><a href="#contact">FLOCK Result</a></li>
          </ul>
          <p class="navbar-text pull-right">
            Current Project: "TEST1" | Logged in as <a href="#" class="navbar-link">Username</a>            
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="container fill" id="centerContent" style="margin-left:20px;">
    <div class="row fill">
      <div class="span2 fill">
        <div class="well" id="fileNav" style="overflow:auto;"></div>
      </div>
      <div class="span10">
        <div class="row">
          <div class="span12">
            <div class="span11 offset1" id="details">
              <table>
                <tr>
                  <td><strong>Method Name</strong></td><td>FLOCK</td>
                </tr>
                <tr>
                  <td><strong>Method Version</strong></td><td>v0.1</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="span12" id="overview">
            <div class="row">
              <div class="span3">
                <h4 id="overviewH4">Overview</h4>
                <img src="../images/ajax-loader.gif" id="loading-indicator" style="display:none;"/>
              </div>
              <div class="span3">
                <select id="populselect" class="selectpicker"></select>
              </div>
            </div>
            <div id="flock_main">
              <div id="flock_content">
                <table id="overviewTable"></table>
              </div>
            </div>
          </div>
        </div>
      </div>  
    </div>
  </div>

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../js/jquery-1.10.2.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/jqueryFileTree.js"></script>
    <script src="../js/bootstrap-select.min.js"></script>
    <script>
    var _page = {
      draw: function(data) {
        var imgHtml = '<img src="$imgPath$"/>';

        if(data && data.columns && data.taskDir && data.type && data.pops) {
          var cols = data.columns, 
              taskId = data.taskId,
              taskDir = data.taskDir, 
              type = data.type, 
              popId = data.popId,
              imgPostfix = (type=='pop'?popId+'.color.highlighted':'all.'+type),
              thead = '<thead><tr><th id="name"></th>', 
              tbody = '<tbody>',
              pops = data.pops;

          for(var i=0;i<cols.length;i++) {
            thead+='<th id="'+cols[i]+'">'+cols[i]+'</th>';
            tbody+='<tr><th id="'+cols[i]+'_'+cols[i]+'" headers="name">'+cols[i]+'</th>';
            for(var j=0;j<cols.length;j++) {
              tbody+='<td headers="'+cols[j]+' '+cols[i]+'">'
              +imgHtml.replace("$imgPath$", taskDir+type+"/"+cols[j]+"."+cols[i]+'.'+imgPostfix+'.png');
              +'</td>'
            }
            tbody+='</tr>';
          }
          tbody+='</tbody>';
          thead+='</tr></thead>';
          $('#overviewTable').html(thead+tbody);

          if(type==='color') {
            this.popul(taskId, pops);
          }
          $('#loading-indicator').hide();
        }
      },
      popul: function(taskId, pops) {
        var _this = this;
        var populHtml = '<option data-content="<span class=\'$c$\'>&nbsp;&nbsp;&nbsp;</span>$t$">$v$</option>',
            $selecObj = $('.selectpicker');

        $selecObj.append(
          populHtml.replace("$c$", "")
            .replace("$t$", "Overview")
            .replace("$v$",0)
          );
        $.each(pops, function(i,pop){
          $selecObj.append(
            populHtml.replace("$c$", "popul"+(i>24?i%25+1:i))
              .replace("$t$", "Population "+i+"("+pop+")")
              .replace("$v$",i)
            );
        });
        $selecObj.selectpicker('deselectAll');
        $selecObj.change(function(){
          var currPopul = $selecObj.find("option:selected").val();
          $('#overviewH4').html(currPopul==='0'?'Overview':'Population '+currPopul);
          _this.ajax(taskId, currPopul==='0'?'color':'pop', currPopul);
        });
      },
      ajax: function(taskId, type, popId) {
        var _this = this;
        $('#loading-indicator').show();
        $.ajax({
          url: '../modules/loadResults.php?taskId='+taskId+'&type='+type+'&popId='+popId
        }).done(function(data) {
          if(data) {
            data = $.parseJSON(data);
            _this.draw(data);
          }
        });
      }
      } //_page END

      $(document).ready(function() {
        //_utils.loadOverview(1);
        $('#fileNav').fileTree({
            root: '../Tasks/', //'/export/gofcm/Tasks/',
            script: '../modules/jqueryFileTree.php',
            expandSpeed: 1000,
            collapseSpeed: 13000,
            multiFolder: false
          }, function(file) {
            alert(file);
        });
        _page.ajax('51f6d35da9d945c814b49d4c', 'color', 3);
      });
      </script>
    </body>
    </html>
